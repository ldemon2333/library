Go è¯­è¨€åœ¨ Go 1.18 å¼€å§‹æ­£å¼æ”¯æŒ **æ³›å‹ç¼–ç¨‹**ï¼Œè¿™æ˜¯ Go ç¤¾åŒºé•¿æœŸæœŸå¾…çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ä¸‹é¢æˆ‘ä¼šä»åŸºç¡€å¼€å§‹ï¼Œé€æ­¥å¸¦ä½ ç†è§£ Go æ³›å‹çš„æ ¸å¿ƒæ¦‚å¿µä¸ä½¿ç”¨æ–¹å¼ï¼Œå¹¶é€šè¿‡ç¤ºä¾‹è¯´æ˜å…¶ç”¨æ³•ã€‚

---

## ğŸŒŸ ä¸€ã€ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ

æ³›å‹ï¼ˆGenericsï¼‰å…è®¸ä½ ç¼–å†™ **ç±»å‹å‚æ•°åŒ–çš„å‡½æ•°å’Œæ•°æ®ç»“æ„**ï¼Œä½¿ä»£ç èƒ½é€‚ç”¨äºå¤šç§ç±»å‹ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ç§ç±»å‹éƒ½å†™ä¸€éã€‚

> å°±åƒæ¨¡æ¿å‡½æ•°ã€æ¨¡æ¿ç±»åœ¨ C++ ä¸­çš„ä½œç”¨ä¸€æ ·ã€‚

---

## ğŸ“¦ äºŒã€å‡½æ•°æ³›å‹è¯­æ³•

### âœ¨ ç¤ºä¾‹ï¼šäº¤æ¢ä¸¤ä¸ªå€¼çš„å‡½æ•°

```go
package main

import "fmt"

// å®šä¹‰æ³›å‹å‡½æ•° Swapï¼ŒT æ˜¯ç±»å‹å‚æ•°
func Swap[T any](a, b T) (T, T) {
	return b, a
}

func main() {
	// ä½¿ç”¨ int
	x, y := Swap[int](1, 2)
	fmt.Println(x, y) // è¾“å‡ºï¼š2 1

	// ä½¿ç”¨ string
	s1, s2 := Swap[string]("hello", "world")
	fmt.Println(s1, s2) // è¾“å‡ºï¼šworld hello
}
```

### âœ… è¯­æ³•è§£æï¼š

- `[T any]`ï¼šå£°æ˜äº†ä¸€ä¸ªç±»å‹å‚æ•° `T`ï¼Œå…¶ä¸­ `any` æ˜¯çº¦æŸï¼Œè¡¨ç¤ºä»»æ„ç±»å‹ï¼ˆç­‰ä»·äº interface{}ï¼‰ã€‚
    
- æ³›å‹å‡½æ•°çš„è°ƒç”¨å¯ä»¥æ˜¾å¼å†™å‡ºç±»å‹å‚æ•°ï¼ˆå¦‚ `Swap[int]`ï¼‰ï¼Œä¹Ÿå¯ä»¥è®©ç¼–è¯‘å™¨è‡ªåŠ¨æ¨å¯¼ï¼ˆ`Swap(1, 2)`ï¼‰ã€‚
    

---

## ğŸ—ï¸ ä¸‰ã€æ³›å‹ç»“æ„ä½“

```go
package main

import "fmt"

// å®šä¹‰ä¸€ä¸ªæ³›å‹ç»“æ„ä½“
type Pair[T any] struct {
	First  T
	Second T
}

func main() {
	intPair := Pair[int]{First: 1, Second: 2}
	fmt.Println(intPair) // {1 2}

	stringPair := Pair[string]{First: "a", Second: "b"}
	fmt.Println(stringPair) // {a b}
}
```

---

## ğŸ“ å››ã€æ³›å‹çº¦æŸï¼ˆConstraintsï¼‰

é»˜è®¤ `T any` è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¥å£æ¥ **çº¦æŸç±»å‹å‚æ•°**ã€‚

### ç¤ºä¾‹ï¼šçº¦æŸç±»å‹ä¸ºæ•°å­—ç±»å‹

```go
package main

import "fmt"

// å®šä¹‰ Number çº¦æŸï¼Œåªå…è®¸ int å’Œ float64 ç±»å‹
type Number interface {
	int | float64
}

// æ³›å‹å‡½æ•°ï¼šæ±‚å’Œ
func Add[T Number](a, b T) T {
	return a + b
}

func main() {
	fmt.Println(Add(1, 2))       // int
	fmt.Println(Add(1.5, 2.5))   // float64
	// fmt.Println(Add("a", "b")) // ç¼–è¯‘é”™è¯¯ï¼šstring ä¸ç¬¦åˆ Number çº¦æŸ
}
```

---

## ğŸ“š äº”ã€æ³›å‹æ–¹æ³•

```go
type Stack[T any] struct {
	data []T
}

func (s *Stack[T]) Push(v T) {
	s.data = append(s.data, v)
}

func (s *Stack[T]) Pop() T {
	n := len(s.data)
	v := s.data[n-1]
	s.data = s.data[:n-1]
	return v
}
```

---

## ğŸ§  å…­ã€æ³›å‹ç±»å‹æ¨å¯¼ï¼ˆç±»å‹æ¨ç†ï¼‰

Go ç¼–è¯‘å™¨èƒ½æ ¹æ®å‚æ•°è‡ªåŠ¨æ¨å¯¼ç±»å‹ï¼Œå› æ­¤ä½ å¸¸å¸¸å¯ä»¥çœç•¥ç±»å‹å‚æ•°ã€‚

```go
x, y := Swap(3, 4)         // æ¨å¯¼ä¸º int
s1, s2 := Swap("a", "b")   // æ¨å¯¼ä¸º string
```

---

## ğŸ›  ä¸ƒã€å®ç”¨å°æŠ€å·§

### ğŸ‘‡ ä½¿ç”¨ `comparable` çº¦æŸç”¨äº map key æˆ–æ¯”è¾ƒæ“ä½œï¼š

```go
func IndexOf[T comparable](s []T, target T) int {
	for i, v := range s {
		if v == target {
			return i
		}
	}
	return -1
}
```


## ğŸ“Œ æ€»ç»“

| ç‰¹æ€§    | ç¤ºä¾‹                        |
| ----- | ------------------------- |
| å‡½æ•°æ³›å‹  | `func Swap[T any](...)`   |
| ç±»å‹å‚æ•°  | `[T any]`                 |
| æ³›å‹ç»“æ„ä½“ | `type Pair[T any] struct` |
| æ³›å‹çº¦æŸ  | `type Number interface`   |
| ç‰¹æ®Šçº¦æŸ  | `comparable`, `any`       |


`func NewTypedRateLimitingQueue[T comparable](rateLimiter TypedRateLimiter[T]) TypedRateLimitingInterface[T]` è¿™ä¸ªå‡½æ•°ç­¾åå±•ç¤ºäº† Go è¯­è¨€ä¸­æ³›å‹çš„ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨æ„å»ºä¸€ä¸ªå¸¦æœ‰ç±»å‹é™åˆ¶çš„é€Ÿç‡é™åˆ¶é˜Ÿåˆ—æ—¶ã€‚

---

### Go æ³›å‹çš„æ ¸å¿ƒæ¦‚å¿µ

Go åœ¨ 1.18 ç‰ˆæœ¬å¼•å…¥äº†æ³›å‹ï¼ˆGenericsï¼‰ï¼Œå®ƒå…è®¸å¼€å‘è€…ç¼–å†™**ä¸ä¾èµ–ç‰¹å®šç±»å‹**çš„ä»£ç ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åˆ›å»ºå‡½æ•°ã€ç±»å‹æˆ–æ–¹æ³•ï¼Œè¿™äº›å‡½æ•°ã€ç±»å‹æˆ–æ–¹æ³•å¯ä»¥å¤„ç†å¤šç§æ•°æ®ç±»å‹ï¼Œè€Œæ— éœ€ä¸ºæ¯ç§ç±»å‹ç¼–å†™é‡å¤çš„ä»£ç ã€‚

åœ¨æ³›å‹ä¸­ï¼Œæœ€æ ¸å¿ƒçš„å‡ ä¸ªæ¦‚å¿µæ˜¯ï¼š

1. **ç±»å‹å‚æ•° (Type Parameters)ï¼š** æ–¹æ‹¬å· `[]` ä¸­å£°æ˜çš„æ ‡è¯†ç¬¦ï¼Œä»£è¡¨ä¸€ä¸ªæˆ–å¤šä¸ªæœªçŸ¥ç±»å‹ã€‚
    
2. **ç±»å‹çº¦æŸ (Type Constraints)ï¼š** é™åˆ¶ç±»å‹å‚æ•°å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œç¡®ä¿æ³›å‹ä»£ç å¯ä»¥å®‰å…¨åœ°å¯¹è¿™äº›ç±»å‹æ‰§è¡Œæ“ä½œã€‚
    

---

### æ·±å…¥è§£æå‡½æ•°ç­¾å

ç°åœ¨æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Š `func NewTypedRateLimitingQueue[T comparable](rateLimiter TypedRateLimiter[T]) TypedRateLimitingInterface[T]`ï¼š

#### 1. `[T comparable]` - ç±»å‹å‚æ•°å’Œç±»å‹çº¦æŸ

- **`[T ...]`ï¼š** è¿™æ˜¯ Go æ³›å‹çš„è¯­æ³•ï¼Œè¡¨ç¤º `NewTypedRateLimitingQueue` æ˜¯ä¸€ä¸ªæ³›å‹å‡½æ•°ã€‚`T` æ˜¯ä¸€ä¸ª**ç±»å‹å‚æ•°**ï¼Œå®ƒä»£è¡¨äº†æœªæ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ä¼šä¼ å…¥çš„å…·ä½“ç±»å‹ã€‚
    
- **`comparable`ï¼š** è¿™æ˜¯å¯¹ç±»å‹å‚æ•° `T` çš„ä¸€ä¸ª**ç±»å‹çº¦æŸ**ã€‚
    
    - åœ¨ Go è¯­è¨€ä¸­ï¼Œ`comparable` æ˜¯ä¸€ä¸ª**é¢„å®šä¹‰çš„æ¥å£**ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼‰ã€‚
        
    - å®ƒè¦æ±‚ä¼ å…¥çš„ç±»å‹ `T` å¿…é¡»æ˜¯**å¯æ¯”è¾ƒçš„**ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ `==` å’Œ `!=` è¿ç®—ç¬¦æ¥æ¯”è¾ƒè¿™ç§ç±»å‹çš„ä¸¤ä¸ªå€¼ã€‚
        
    - å¯æ¯”è¾ƒçš„ç±»å‹åŒ…æ‹¬ï¼šå¸ƒå°”å‹ã€æ•°å€¼å‹ï¼ˆæ•´å‹ã€æµ®ç‚¹å‹ã€å¤æ•°ï¼‰ã€å­—ç¬¦ä¸²ã€æŒ‡é’ˆã€é€šé“ (channel)ã€æ¥å£ (interface)ã€ç»“æ„ä½“ (struct)ï¼ˆå¦‚æœæ‰€æœ‰å­—æ®µéƒ½å¯æ¯”è¾ƒï¼‰ã€æ•°ç»„ (array)ï¼ˆå¦‚æœå…ƒç´ ç±»å‹å¯æ¯”è¾ƒï¼‰ã€‚
        
    - **ä¸ºä»€ä¹ˆéœ€è¦ `comparable` çº¦æŸï¼Ÿ** é€Ÿç‡é™åˆ¶é˜Ÿåˆ—é€šå¸¸éœ€è¦èƒ½å¤Ÿå”¯ä¸€æ ‡è¯†é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œä»¥ä¾¿å¯¹å®ƒä»¬è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚è€Œæ¯”è¾ƒæ“ä½œï¼ˆä¾‹å¦‚ï¼Œåˆ¤æ–­ä¸¤ä¸ªä»»åŠ¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªä»»åŠ¡ï¼Œæˆ–è€…åœ¨å†…éƒ¨ map ä¸­å­˜å‚¨å…ƒç´ æ—¶ä½œä¸ºé”®ï¼‰æ˜¯å®ç°è¿™ä¸€åŠŸèƒ½çš„å…³é”®ã€‚å¦‚æœæ²¡æœ‰ `comparable` çº¦æŸï¼Œç¼–è¯‘å™¨å°±æ— æ³•ä¿è¯ `T` ç±»å‹çš„å…ƒç´ å¯ä»¥è¢«æ¯”è¾ƒï¼Œä»è€Œå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯æˆ–æ— æ³•å®ç°é¢„æœŸçš„é€»è¾‘ã€‚
        

#### 2. `(rateLimiter TypedRateLimiter[T])` - å‚æ•°åˆ—è¡¨

- **`rateLimiter`ï¼š** è¿™æ˜¯å‡½æ•°çš„ç¬¬ä¸€ä¸ªï¼ˆä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªï¼‰å‚æ•°çš„åç§°ã€‚
    
- **`TypedRateLimiter[T]`ï¼š** è¿™æ˜¯å‚æ•° `rateLimiter` çš„ç±»å‹ã€‚
    
    - è¿™é‡Œçš„ `TypedRateLimiter` æ˜¾ç„¶æ˜¯ä¸€ä¸ª**æ³›å‹æ¥å£æˆ–æ³›å‹ç»“æ„ä½“**ã€‚
        
    - å®ƒä¹Ÿæ¥å—ä¸€ä¸ªç±»å‹å‚æ•° `T`ï¼Œè¿™ä¸ª `T` å°±æ˜¯å‡½æ•°ç­¾åä¸­å®šä¹‰çš„é‚£ä¸ª `T`ã€‚
        
    - è¿™æ„å‘³ç€ `rateLimiter` è¿™ä¸ªå‚æ•°çš„ç±»å‹å¿…é¡»æ˜¯ä¸€ä¸ªä¸“é—¨å¤„ç†ä¸é˜Ÿåˆ—å…ƒç´  `T` ç›¸åŒç±»å‹çš„é€Ÿç‡é™åˆ¶å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„é˜Ÿåˆ—å¤„ç†å­—ç¬¦ä¸² `string`ï¼Œé‚£ä¹ˆä¼ å…¥çš„ `rateLimiter` ä¹Ÿå¿…é¡»æ˜¯ `TypedRateLimiter[string]` ç±»å‹ã€‚
        

#### 3. `TypedRateLimitingInterface[T]` - è¿”å›å€¼ç±»å‹

- **`TypedRateLimitingInterface[T]`ï¼š** è¿™æ˜¯å‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚
    
    - åŒæ ·ï¼Œ`TypedRateLimitingInterface` ä¹Ÿæ˜¯ä¸€ä¸ª**æ³›å‹æ¥å£**ã€‚
        
    - å®ƒæ¥å—ç±»å‹å‚æ•° `T`ï¼Œç¡®ä¿è¿”å›çš„é˜Ÿåˆ—æ¥å£ä¹Ÿæ˜¯é’ˆå¯¹ç‰¹å®šç±»å‹ `T` è¿›è¡Œæ“ä½œçš„ã€‚
        
    - è¿™ä¸ªè¿”å›çš„æ¥å£ä¼šå®šä¹‰é˜Ÿåˆ—æ‰€èƒ½æä¾›çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ·»åŠ å…ƒç´ ã€è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ã€åˆ¤æ–­æ˜¯å¦åº”è¯¥å¤„ç†æŸä¸ªå…ƒç´ ï¼ˆç”±é€Ÿç‡é™åˆ¶å™¨å†³å®šï¼‰ç­‰ç­‰ã€‚
        

---

### æ•´ä½“ç†è§£è¿™ä¸ªå‡½æ•°ç­¾å

`func NewTypedRateLimitingQueue[T comparable](...) ...` çš„æ„å›¾æ˜¯ï¼š

â€œ**åˆ›å»ºä¸€ä¸ªæ–°çš„é€Ÿç‡é™åˆ¶é˜Ÿåˆ—å®ä¾‹ã€‚**

- è¿™ä¸ªé˜Ÿåˆ—æ˜¯**æ³›å‹çš„**ï¼Œå¯ä»¥å¤„ç†ä»»ä½•å¯æ¯”è¾ƒçš„ç±»å‹ `T` çš„å…ƒç´ ã€‚
    
- ä½ éœ€è¦æä¾›ä¸€ä¸ª**ä¸“é—¨å¤„ç†ç±»å‹ `T` çš„é€Ÿç‡é™åˆ¶å™¨**ä½œä¸ºå‚æ•°ã€‚
    
- å®ƒå°†è¿”å›ä¸€ä¸ª**èƒ½å¯¹ç±»å‹ `T` è¿›è¡Œæ“ä½œçš„é€Ÿç‡é™åˆ¶é˜Ÿåˆ—æ¥å£**ã€‚â€
    

**ä¸¾ä¾‹è¯´æ˜ï¼š**

å¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªå¤„ç†ç”¨æˆ· IDï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰çš„é€Ÿç‡é™åˆ¶é˜Ÿåˆ—ï¼š


```
// å‡è®¾ TypedRateLimiter å’Œ TypedRateLimitingInterface å·²ç»å®šä¹‰å¥½äº†
// ä¾‹å¦‚ï¼š
// type TypedRateLimiter[T comparable] interface {
//     Acquire(item T) // å°è¯•è·å–ä»¤ç‰Œ
//     When(item T) time.Duration // è·å–ä»¤ç‰Œå‰éœ€è¦ç­‰å¾…çš„æ—¶é—´
// }
// type TypedRateLimitingInterface[T comparable] interface {
//     Add(item T)
//     Get() (T, bool)
//     // ... å…¶ä»–é˜Ÿåˆ—æ“ä½œ
// }

// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå…·ä½“çš„å­—ç¬¦ä¸²é€Ÿç‡é™åˆ¶å™¨å®ç°
type StringRateLimiter struct{}
func (s *StringRateLimiter) Acquire(item string) { /* ... */ }
func (s *StringRateLimiter) When(item string) time.Duration { return 0 }

func main() {
    // å®ä¾‹åŒ–ä¸€ä¸ªå¤„ç†å­—ç¬¦ä¸²ç±»å‹çš„é€Ÿç‡é™åˆ¶å™¨
    myStringRateLimiter := &StringRateLimiter{}

    // ä½¿ç”¨æ³›å‹å‡½æ•°åˆ›å»ºå¤„ç†å­—ç¬¦ä¸²çš„é€Ÿç‡é™åˆ¶é˜Ÿåˆ—
    stringQueue := NewTypedRateLimitingQueue[string](myStringRateLimiter)

    // ç°åœ¨ stringQueue åªèƒ½å¤„ç†å­—ç¬¦ä¸²ç±»å‹çš„å…ƒç´ 
    stringQueue.Add("user123")
    user, ok := stringQueue.Get()
    fmt.Println(user, ok)
}
```

è¿™é‡Œï¼Œ`T` åœ¨è°ƒç”¨ `NewTypedRateLimitingQueue[string]` æ—¶è¢«å®ä¾‹åŒ–ä¸º `string` ç±»å‹ï¼Œå› æ­¤æ•´ä¸ªå‡½æ•°ç­¾åä¸­çš„ `T` éƒ½å˜æˆäº† `string`ã€‚

---

### æ³›å‹å¸¦æ¥çš„å¥½å¤„

- **ä»£ç å¤ç”¨ï¼š** ä½ ä¸éœ€è¦ä¸º `string`ã€`int`ã€è‡ªå®šä¹‰ç»“æ„ä½“ç­‰æ¯ç§ç±»å‹éƒ½ç¼–å†™ä¸€ä¸ª `NewStringRateLimitingQueue`ã€`NewIntRateLimitingQueue` ç­‰å‡½æ•°ã€‚
    
- **ç±»å‹å®‰å…¨ï¼š** ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹çº¦æŸï¼Œç¡®ä¿ä½ ä¼ å…¥çš„ç±»å‹æ˜¯åˆæ³•çš„ï¼Œå¹¶ä¸”åœ¨æ³›å‹ä»£ç å†…éƒ¨æ‰§è¡Œçš„æ“ä½œæ˜¯å®‰å…¨çš„ã€‚è¿™é¿å…äº†è¿è¡Œæ—¶ç±»å‹æ–­è¨€å’Œæ½œåœ¨çš„é”™è¯¯ã€‚
    
- **æ¸…æ™°çš„æ¥å£ï¼š** é€šè¿‡ç±»å‹å‚æ•°ï¼Œæ¥å£çš„æ„å›¾æ›´åŠ æ˜ç¡®ï¼Œå®ƒå°†åªå¤„ç†å®ƒè¢«å®ä¾‹åŒ–æ—¶æŒ‡å®šçš„ç±»å‹ã€‚
    

è¿™ä¸ªå‡½æ•°ç­¾åæ˜¯ Go æ³›å‹åœ¨å®é™…å¤æ‚åœºæ™¯ä¸­å¦‚ä½•å¸®åŠ©æ„å»ºå¯å¤ç”¨ã€ç±»å‹å®‰å…¨çš„ç»„ä»¶çš„ç»ä½³ä¾‹å­ã€‚