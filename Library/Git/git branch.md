## Git 分支教学

Git 的**分支 (branch)** 是其最强大的功能之一，它允许你在不影响项目主线的情况下，独立地进行开发。你可以把它想象成电影制作：主干是最终的电影，而分支是不同的剪辑师在同一时间制作的独立版本。他们可以在自己的版本上自由尝试，直到满意为止，然后将他们的更改合并到主电影中。

### 什么是 Git 分支？

在 Git 中，一个**分支**本质上是一个**轻量级的可移动指针**，它指向某个**提交 (commit)**。当你创建一个新提交时，当前分支的指针就会向前移动，指向新的提交。

当你初始化一个 Git 仓库时，默认会创建一个名为 `main`（或旧版本中的 `master`）的分支。这是你项目的主要开发线。

```
A -- B -- C  (main)
```

这里，`main` 指向提交 `C`。

### 为什么要使用分支？

- **并行开发：** 多个开发者可以同时在不同的分支上工作，互不干扰。
    
- **功能隔离：** 新功能、Bug 修复或实验性更改可以在单独的分支上进行，确保主分支的稳定性。
    
- **安全网：** 如果你在一个分支上搞砸了，不会影响到其他分支或主项目。
    
- **代码审查：** 完成的特性分支可以被其他人审查，没问题后再合并到主分支。
    

### 基本分支操作

---

#### 1. 查看分支

要查看你本地仓库中的所有分支，以及你当前所在的分支，可以使用：


```
git branch
```

你当前所在的分支会有一个星号 (`*`) 标记。


```
* main
  feature/my-new-feature
  bugfix/fix-login
```

要查看本地和远程的所有分支，可以使用：


```
git branch -a
```

---

#### 2. 创建新分支

要创建一个新分支，但仍停留在当前分支：

```
git branch <新分支名称>
```

例如，从 `main` 分支创建一个名为 `feature/user-profile` 的新分支：

```
git branch feature/user-profile
```

此时，你的仓库看起来像这样：

```
A -- B -- C  (HEAD -> main, feature/user-profile)
```

注意，`feature/user-profile` 分支现在也指向提交 `C`，但你仍然在 `main` 分支上。

---

#### 3. 切换分支

要切换到另一个分支，让你的工作目录反映该分支所指向的提交状态：


```
git checkout <分支名称>
```

例如，切换到刚刚创建的 `feature/user-profile` 分支：


```
git checkout feature/user-profile
```

现在，`HEAD` 指向 `feature/user-profile`：

```
A -- B -- C  (main, HEAD -> feature/user-profile)
```

---

#### 4. 创建并切换到新分支（常用）

这是最常用的操作之一，它结合了创建和切换两个步骤：


```
git checkout -b <新分支名称>
```

例如：


```
git checkout -b feature/add-dark-mode
```

这会基于你当前所在的分支创建一个新分支 `feature/add-dark-mode`，并立即切换到这个新分支。

---

#### 5. 删除分支

当你完成一个分支的工作并将其合并到其他分支后，通常会删除它。

**删除本地分支：**

- **安全删除 (`-d` 或 `--delete`)：** 只能删除已合并到其上游分支（或 HEAD）的分支。如果分支上有未合并的更改，Git 会阻止删除。
    
    ```
    git branch -d <分支名称>
    ```
    
    例如：
    
    
    ```
    git branch -d feature/user-profile
    ```
    
- **强制删除 (`-D` 或 `--force`)：** 无论分支是否已合并，都会强制删除。**慎用此命令**，因为它可能导致未合并的工作丢失。
    
    
    ```
    git branch -D <分支名称>
    ```
    

**删除远程分支：**

远程分支也需要单独删除。


```
git push origin --delete <远程分支名称>
# 或者更简洁的写法
git push origin :<远程分支名称>
```

例如，删除远程的 `feature/user-profile` 分支：


```
git push origin --delete feature/user-profile
```

---

### 分支的最佳实践

- **主分支 (`main`/`master`)：** 始终保持 `main` 分支的稳定和可发布状态。不要直接在 `main` 上开发新功能。
    
- **特性分支 (`feature/*`)：** 为每个新功能创建一个单独的分支。命名清晰，例如 `feature/add-user-auth`。
    
- **Bug 修复分支 (`bugfix/*`)：** 为每个 Bug 修复创建一个单独的分支。命名例如 `bugfix/fix-login-error`。
    
- **长期支持分支 (`release/*`)：** 如果你需要维护多个发布版本，可以创建发布分支。
    
- **及时合并/删除：** 完成功能或修复后，尽快将其合并到 `main` 分支并删除不再需要的特性分支。
    
- **频繁拉取和合并/变基：** 在开始工作前和提交之前，经常从 `main` 分支拉取最新更改，以避免大的冲突。你可以选择使用 `git merge` 或 `git rebase`。
    



git branch -f main HEAD~3

我使用相对引用最多的就是移动分支。可以直接使用 `-f` 选项让分支指向另一个提交。例如:

上面的命令会将 main 分支强制指向 HEAD 的第 3 级 parent 提交