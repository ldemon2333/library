## Git Revert 解释

`git revert` 是 Git 中一个非常重要的命令，它用于**撤销（undo）** 已经存在的提交。但与你可能想到的“回滚”不同，`git revert` 不会删除或修改历史提交，而是会**创建一个新的提交**来撤销指定提交所引入的更改。

简单来说，`git revert` 的核心思想是**“撤销一个提交，同时保留历史记录”**。

---

### `git revert` 的工作原理

假设你有以下提交历史：

```
A -- B -- C -- D (HEAD -> main)
```

现在，你发现提交 `C` 引入了一个 Bug，或者它的更改是不正确的，你想撤销它。

如果你运行 `git revert C`：

1. Git 会识别出提交 `C` 中所做的所有更改（添加、删除、修改了哪些代码）。
    
2. 然后，Git 会**反向应用**这些更改。例如，如果 `C` 添加了一行代码，那么 `revert C` 就会删除那一行；如果 `C` 删除了一行代码，那么 `revert C` 就会恢复那一行。
    
3. 最终，Git 会创建一个**新的提交 `E`**，这个新提交的内容就是撤销 `C` 后的状态。
    

结果将是这样：

```
A -- B -- C -- D -- E (HEAD -> main)
```

提交 `E` 就是撤销 `C` 的提交。提交 `C` 仍然存在于历史中，只是它的效果被 `E` 抵消了。

---

### 为什么要使用 `git revert` 而不是其他方式？

Git 中有几种撤销更改的方法，但 `git revert` 有其独特的优势和适用场景：

1. **`git reset`**：
    
    - `git reset` 命令可以让你将分支指针和 HEAD 移动到之前的提交。它可以“删除”或“取消”提交，使它们不再出现在当前分支的历史中（至少从指针的角度看）。
        
    - **缺点：** `git reset` 会重写历史。这意味着如果你已经将这些提交推送到了共享的远程仓库，那么使用 `git reset` 会导致你和协作伙伴的历史不匹配，从而引发混乱和冲突。
        
    - **适用场景：** 通常用于撤销**尚未推送到远程仓库**的本地提交。
        
2. **直接修改并提交**：
    
    - 你也可以手动修改代码，然后创建一个新的提交来修复 Bug 或撤销更改。
        
    - **缺点：** 这种方式没有明确的记录表明你在撤销一个特定的提交。当需要追溯历史时，不明确。
        
    - **适用场景：** 当更改非常小，或者你不想专门进行一次撤销提交时。
        

**`git revert` 的优势：**

- **安全地撤销已发布的提交：** 这是 `git revert` 最核心的优势。因为它创建了一个新的提交，而不是重写历史，所以你可以安全地撤销那些已经被推送到共享远程仓库的提交，而不会对其他协作者的工作流造成破坏。
    
- **保留完整的提交历史：** 所有的提交都保留在历史记录中，包括被撤销的提交和撤销操作本身。这对于审计和理解项目演变过程非常有帮助。
    
- **明确意图：** `revert` 提交会清晰地表明你正在撤销一个特定的提交，其提交信息通常会包含被撤销提交的哈希值和原始提交信息。
    

---

### `git revert` 的基本用法

#### 1. 撤销单个提交

```
git revert <提交哈希值或引用>
```

例如，要撤销提交 `abcdef`：


```
git revert abcdef
```

执行此命令后，Git 会弹出一个编辑器，让你编辑新撤销提交的提交信息。默认的提交信息会包含被撤销提交的原始信息。保存并关闭编辑器后，新的撤销提交就会被创建。

#### 2. 撤销多个提交

你可以一次性撤销一系列提交。Git 会按照你指定的顺序，从最旧的提交开始，依次创建撤销提交。


```
git revert <提交哈希值A> <提交哈希值B> <提交哈希值C>
```

或者，如果你想撤销一个范围内的提交（不包括起始提交，包括结束提交）：


```
git revert <起始提交哈希值>..<结束提交哈希值>
```

例如，要撤销从 `commit-X` 到 `commit-Y` 之间的所有提交（不包括 `commit-X` 本身）：


```
git revert commit-X..commit-Y
```

#### 3. 撤销而不立即提交 (`-n` 或 `--no-commit`)

如果你想撤销更改，但不想立即创建一个新的提交，而是想在撤销后进行一些额外的修改，然后再手动提交，可以使用 `-n` 选项：


```
git revert -n <提交哈希值>
```

这会将撤销的更改应用到你的工作区和暂存区，但不会自动提交。你可以像处理普通修改一样，进行额外的更改，然后 `git add` 和 `git commit`。

---

### `git revert` 冲突处理

如果被撤销的提交所做的更改与当前分支上的其他更改发生冲突，`git revert` 也会像 `git merge` 或 `git rebase` 一样暂停，并提示你解决冲突。

解决冲突的步骤：

1. Git 会显示冲突标记（`<<<<<<<`, `=======`, `>>>>>>>`）在冲突文件中。
    
2. 手动编辑这些文件，解决冲突，选择你想要保留的代码。
    
3. 使用 `git add <冲突文件>` 将解决后的文件标记为已解决。
    
4. 继续 `revert` 过程：`git revert --continue`。
    
5. 如果你想取消当前的 `revert` 操作：`git revert --abort`。
    

---

### 总结

- `git revert` 用于**安全地撤销已存在的提交**，通过**创建一个新的提交**来反向应用指定提交的更改。
    
- 它**不会重写历史**，因此特别适合撤销那些已经被推送到共享远程仓库的提交。
    
- 它保留了完整的提交历史，易于追溯。
    
- 与 `git reset`（重写历史）和直接修改（不明确意图）相比，`git revert` 是撤销已发布提交的**首选方法**。
    

理解 `git revert` 的工作原理和适用场景，能够帮助你更安全、更有效地管理 Git 项目的历史记录。

还有关于 `git revert` 或其他 Git 命令的问题吗？