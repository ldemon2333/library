# MQTT 简介
[MQTT](https://mqtt.org/)（Message Queuing Telemetry Transport，消息队列遥测传输）协议是应用于物联网等领域的即时通信协议。


# 协议特点
MQTT协议是为大量计算能力有限，且工作在低带宽、不可靠的网络的远程传感器和控制设备通讯而设计的协议，它具有以下主要的几项特性：
- 使用发布/订阅消息模式，提供一对多的消息分布，解除应用程序耦合；
- 对负载内容屏蔽的消息传输；
- 使用 TCP/IP 提供网络连接；
- 小型传输，开销很小（固定长度的头部是 2 字节），协议交换最小化，以降低网络流量；
- 使用 Last Will 和 Testament 特性通知有关各方客户端异常中断的机制；
- 有三种消息发布服务质量：
	- 至多一次，消息至多发送一次。
	- 至少一次，确保信息到达，但消息重复可能会发生。
	- 只有一次，确保信息到达一次。

# 对接流程
## 操作前提
1. 已创建好产品和设备（创建产品、设备管理）
2. 定义好产品模型（模型管理）
3. 设备必须是直连设备（子设备不能直连）

## 接入流程
1. 点击产品详情中获取接入地址信息。
2. 获取设备详情中接入devId,devSecret,topic等信息。
3. 连接服务。
4. 配置订阅topic, 订阅下发数据。
5. 配置发布topic, 发送上报数据 。
6. 断开连接，设备下线。
![[Pasted image 20250115135213.png]]
# 鉴权方式
https://dmp.ictsoft.cn/docs/content/%E8%AE%BE%E5%A4%87%E6%8E%A5%E5%85%A5/MQTT%E5%8D%8F%E8%AE%AE/%E9%89%B4%E6%9D%83%E6%96%B9%E5%BC%8F.html

# 消息通信 Topic
## 什么是 Topic
Topic是消息发布（Pub）者和订阅（Sub）者之间的传输中介。设备可通过Topic实现消息的发送和接收，从而实现服务端与设备端的通信。 为方便海量设备基于Topic进行通信，简化授权操作，物联网平台定义了产品Topic类和设备Topic。

## 设备 Topic
交互协议为MQTT的设备，服务端跟设备端是通过Topic来实现消息通信的。设备创建好后，设备所隶属的产品下的Topic类会自动映射到设备上。真正用于消息通信的是具体的设备Topic。用户可点击左侧边栏中的“设备管理”，单击设备列表中设备的“查看”按钮，点击“Topic列表”，可查看和复制具体的设备Topic，用于设备消息通信。
![[Pasted image 20250115140237.png]]
- 设备对应的Topic是从产品Topic类映射出来，根据设备ID动态创建的。每个设备的Topic唯一，只能被该设备用于消息通信。
- 操作权限说明了设备对topic的操作权限，当设备对无权限的topic进行操作时，mqtt连接会被服务端断开。

# Topic 类及数据格式
## 通用参数说明
- 请求参数
![[Pasted image 20250115140601.png]]
- 参数说明
![[Pasted image 20250115140649.png]]
![[Pasted image 20250115140722.png]]

# Topic 类
## 属性上报
