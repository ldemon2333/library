# 1.背景
但如果你不小心快速格式化了 SD 卡 (现在的相机为了保持兼容性，依然默认是 FAT 文件系统)，文件系统的目录结构被重置，数据块仍然存在，原则上我们可以把数据抢救回来！

想要抢救数据，我们需要理解磁盘是如何格式化的。注意到文件系统是磁盘上的数据结构，如果你希望重置一个数据结构，你就只需要：
```
root->left = root->right = NULL;
```

当然，快速格式化紧接着带来了一个问题：快速格式化(指针赋值)也意味着可以通过遍历存储设备(内存)的方式，将数据结构找回来。在本次试验中，就尝试恢复格式化后的**FAT-32**文件系统镜像。


# 2.实验描述
**从快速格式化的 FAT32 文件系统中恢复图片数据**

实现命令行工具 `fsrecov`，给定一个经过快速格式化 (mkfs.vfat) 的 FAT32 文件系统镜像，镜像格式化前绝大部分文件都是以 BMP 格式存储的，你需要尽可能地从文件系统中恢复出完整的图片文件。

## 2.1 总览
```
fsrecov FILE
```
FILE 是一个 FAT-32 文件系统的镜像。每恢复一张图片文件 (完整的文件，包含 BMP 头和所有数据)，调用系统中的 `sha1sum` 命令获得它的校验和，在标准输出中逐行输出图片文件的校验和以及你恢复出的文件名。只有校验和与文件名**都恢复正确且一致**，才被认为正确恢复了一个文件。

# 3. 实验指南
这里有一份[Microsoft FAT Specification的文档](https://jiaweihawk.github.io/2021/12/05/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0-%E5%85%AB/MSFAT-spec.pdf)。

根据文档可以知道，**FAT**文件系统是由一些头部信息(元数据)、**FAT**(文件分配表)和数据(cluster，微软的官方翻译是”簇”)组成的。如果尝试做一些分析，很容易知道：
1. **FAT**文件的头部是可用的——实验使用同样的方式进行两次格式化；
2. **FAT**表将被清空，此部分的数据相当于全部丢失；
3. 数据区几乎没有变化——实验执行的是**快速**格式化。


# 4. 实验实现
1. 解析FAT文件系统
2. 遍历**Root Directory Region**和**File & Directory(Data) Region**，找出目录项
3. 解析目录项，找出**BMP**类型文件
4. 计算**BMP**文件的**sha1**值，并输出即可

